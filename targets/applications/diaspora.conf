<VirtualHost *:80>
  ServerName diaspora.wvs.localhost
  RedirectPermanent / https://diaspora.wvs.localhost/
</VirtualHost>
<VirtualHost *:443>
 ServerName diaspora.wvs.localhost
 
 DocumentRoot XXX_DIASPORA_PUBLIC_DIR1_XXX

 RewriteEngine On

 RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
 RewriteRule ^/(.*)$ balancer://upstream%{REQUEST_URI} [P,QSA,L]

 <Proxy balancer://upstream>
  BalancerMember http://127.0.0.1:3000
 </Proxy>

 ProxyRequests Off
 ProxyVia On  
 ProxyPreserveHost On
 RequestHeader set X_FORWARDED_PROTO https

 <Proxy *>
  Order allow,deny
  Allow from all
 </Proxy>

 <Directory XXX_DIASPORA_PUBLIC_DIR2_XXX>
  Allow from all
  AllowOverride all
  Options -MultiViews
 </Directory>

 SSLEngine On
 SSLCertificateFile XXX_DIASPORA_SSL_CERT_XXX
 SSLCertificateKeyFile XXX_DIASPORA_SSL_PRIV_KEY_XXX
 
</VirtualHost>
